<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .wrapper {
            margin: 50px auto;
            width: 800px;
            height: 400px;
            border: 1px solid #000;
            position: relative;
            overflow: hidden;
        }

        .image {
            list-style: none;
            width: 500%;
            position: absolute;
        }

        .image img {
            width: 800px;
            height: 400px;
            float: left;
        }

        .btn {
            display: none;
        }

        .btn a {
            text-decoration: none;
            color: black;
            font-size: 50px;
        }

        .left-btn {
            position: absolute;
            top: 180px;
            background-color: rgba(0, 0, 0, .2);
            z-index: 999;
        }

        .right-btn {
            position: absolute;
            top: 180px;
            right: 0;
            background-color: rgba(0, 0, 0, .2);
            z-index: 999;
        }

        .circle {
            position: absolute;
            display: flex;
            bottom: 30px;
            left: 360px;
        }

        .circle li {
            width: 5px;
            height: 5px;
            list-style: none;
            border: 3px solid rgb(204, 203, 203);
            background-color: rgba(0, 0, 0, .3);
            margin: 0 6px;
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <ul class="image">
            <li>
                <a href="#"><img class="img"
                        src="https://img.alicdn.com/imgextra/i3/6000000005349/O1CN01epcIte1pNtI0dHXuE_!!6000000005349-0-octopus.jpg"></a>
            </li>
            <li>
                <a href="#"><img src="https://a1.alicdn.com/assets/p4p-fallback/mm_12852562_1778064_13670999.jpg"></a>
            </li>
            <li>
                <a href="#"><img src="https://a1.alicdn.com/assets/p4p-fallback/mm_12852562_1778064_13674396.jpg"></a>
            </li>
            <li>
                <a href="#"><img src="https://a1.alicdn.com/assets/p4p-fallback/mm_12852562_1778064_13672849.jpg"></a>
            </li>
            <li>
                <a href="#"><img class="img"
                        src="https://img.alicdn.com/imgextra/i3/6000000005349/O1CN01epcIte1pNtI0dHXuE_!!6000000005349-0-octopus.jpg"></a>
            </li>
        </ul>
        <!-- 箭头 -->
        <div class="btn">
            <div class="left-btn"><a href="javascript:;">＜</a></div>
            <div class="right-btn"><a href="javascript:;">＞</a></div>
        </div>
        <!-- 小圆圈 -->
        <ul class="circle"></ul>
    </div>

    <script>
        var circle = document.querySelector('.circle');
        var wrapper = document.querySelector('.wrapper');
        var image = document.querySelector('.image');
        var left_btn = document.querySelector('.left-btn');
        var right_btn = document.querySelector('.right-btn');
        var btn = document.querySelector('.btn');
        var img = document.querySelector('.img');
        //单张图片宽度
        var imgWidth = img.offsetWidth;

        wrapper.addEventListener('mouseenter', function () {
            btn.style.display = 'block';
            clearTimeout(timer);
        });
        wrapper.addEventListener('mouseleave', function () {
            btn.style.display = 'none';
            timer = setInterval(function () {
                right_btn.click();
            }, 2000);
        });

        for (let i = 0; i < image.children.length - 1; i++) {
            //根据图片个数添加小圆圈的个数
            // 创建节点
            var li = document.createElement('li');
            //设置自定义属性
            li.setAttribute('index', i);
            //添加节点
            circle.appendChild(li);
            //小圆圈点击事件
            li.addEventListener('click', function () {
                for (let i = 0; i < circle.children.length; i++) {
                    circle.children[i].style.backgroundColor = 'rgba(0, 0, 0, .3)';
                }
                this.style.backgroundColor = 'white';
                var index = this.getAttribute('index');
                cir = index;
                num = index;
                //图片移动距离：圆圈索引号 * 图片宽度
                animate(image, -index * imgWidth);
            });
        }
        circle.children[0].style.backgroundColor = 'white';

        //设置右箭头
        //图片移动的索引号
        var num = 0;
        //圆圈的索引号
        var cir = 0;
        //节流阀
        var flag = true;
        right_btn.addEventListener('click', function () {
            if (flag) {
                flag = false;
                if (num == image.children.length - 1) {
                    num = 0;
                    image.style.left = 0;
                }
                num++;
                cir++;
                var imgWidth = img.offsetWidth;
                animate(image, -imgWidth * num, function () {
                    flag = true;
                });
                if (cir == circle.children.length) {
                    cir = 0;
                }
                for (let i = 0; i < circle.children.length; i++) {
                    circle.children[i].style.backgroundColor = 'rgba(0, 0, 0, .3)';
                }
                circle.children[cir].style.backgroundColor = 'white';
            }
        });

        //设置左箭头
        left_btn.addEventListener('click', function () {
            if (flag) {
                flag = false;
                if (num == 0) {
                    num = 4;
                    image.style.left = -num * imgWidth + 'px';
                }
                num--;
                cir--;
                animate(image, -imgWidth * num, function () {
                    flag = true;
                });
                if (cir < 0) {
                    cir = circle.children.length - 1;
                }
                for (let i = 0; i < circle.children.length; i++) {
                    circle.children[i].style.backgroundColor = 'rgba(0, 0, 0, .3)';
                }
                circle.children[cir].style.backgroundColor = 'white';
            }
        });

        //自动播放
        var timer = setInterval(function () {
            right_btn.click();
        }, 2000);

        //动画函数封装
        function animate(obj, target, callback) {
            clearTimeout(obj.timer);
            obj.timer = setInterval(function () {
                //步长值写到定时器里
                //把步长值改为整数，不要出现小数的问题
                // var step = Math.ceil((target - obj.offsetLeft) / 10);
                var step = (target - obj.offsetLeft) / 10;
                //如果是正值则向上取整，负值向下取整
                step = step > 0 ? Math.ceil(step) : Math.floor(step);
                if (obj.offsetLeft == target) {
                    //停止动画
                    clearTimeout(obj.timer);
                    //回调函数写到定时器结束里面
                    // if (callback) {
                    //     //调用函数
                    //     callback();
                    // }
                    //短路运算  如果左边为false  则右边不运行
                    callback && callback();
                }
                //把每次加1 这个步长值改为一个慢慢变小的值 
                //步长公式：（目标值 - 现在的位置）/ 10
                obj.style.left = obj.offsetLeft + step + 'px';
            }, 15);
        }
    </script>
</body>

</html>